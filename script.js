const excuses = {
    ml:[
        "എൻ്റെ ആട് ഹോംവർക്ക് പുല്ലാണെന്ന് കരുതി തിന്നു കളഞ്ഞു ടീച്ചറേ.",
       
        "ഇന്നലെ രാത്രിയിലെ കനത്ത മഴയിൽ എൻ്റെ പുസ്തകം ഒലിച്ച് പുഴയിൽ പോയി, ഇപ്പോൾ മീനുകൾ പഠിക്കുന്നുണ്ടാകും.",

        "ഒരു അന്യഗ്രഹജീവി എൻ്റെ ഹോംവർക്ക് പേപ്പർ ഒരു ബഹിരാകാശ മാപ്പായി തെറ്റിദ്ധരിച്ച് കൊണ്ടുപോയി.",
        
        "ഹോംവർക്ക് ചെയ്ത പേപ്പർ കൊണ്ട് അനിയൻ വിമാനം ഉണ്ടാക്കി പറത്തിക്കളഞ്ഞു.",

        "ഹർത്താൽ ആയതുകൊണ്ട് എൻ്റെ പേനയും പണിമുടക്കിൽ ആയിരുന്നു.",

        "ഞാൻ AI വെച്ച് ഹോംവർക്ക് ചെയ്യാൻ നോക്കി, പക്ഷേ അത് മലയാളം സിനിമയുടെ കഥ എഴുതി വെച്ചു.",

        "കറണ്ട് പോയപ്പോൾ മെഴുകുതിരി വെച്ച് പഠിക്കാൻ ഇരുന്നതാ, മെഴുകു മുഴുവൻ പുസ്തകത്തിൽ വീണ് അക്ഷരങ്ങൾ ഒട്ടിച്ചേർന്നു.",

        "അമ്മൂമ്മ എൻ്റെ ഹോംവർക്ക് പേപ്പറിൻ്റെ പുറകിൽ സാമ്പാർ ഉണ്ടാക്കുന്ന വിധം എഴുതിവെച്ചു.",

        "എൻ്റെ അച്ഛൻ ആ പേപ്പറിൽ ലോട്ടറി ടിക്കറ്റിന്റെ നമ്പർ കുറിച്ചുവെച്ചു, ഇനി അടിക്കുമോ എന്നറിയാൻ കാത്തിരിക്കുകയാണ്.",

        "ഞാൻ ഹോംവർക്ക് ഉറക്കെ പഠിക്കുന്നത് കേട്ട് എൻ്റെ തത്ത അതെല്ലാം കാണാതെ പഠിച്ചു, എന്നിട്ട് പറന്നുപോയി.",

        "ഒരു കാക്ക വന്ന് എൻ്റെ പേന കൊത്തിക്കൊണ്ട് പോയി, അതിന് തിളക്കമുണ്ടായിരുന്നു പോലും.",

        "ഹോംവർക്കിന്റെ യഥാർത്ഥ അർത്ഥം എന്താണെന്ന് ആലോചിച്ച് ഞാൻ ധ്യാനത്തിൽ ഇരുന്ന് പോയി.",

        "വീട് വൃത്തിയാക്കുന്നതിനിടയിൽ അമ്മ അതൊരു പഴയ പേപ്പറാണെന്ന് കരുതി തൂക്കി വിറ്റു.",

        "വല്ലാത്തൊരു തലവേദനയായിരുന്നു ടീച്ചറേ, ചോദ്യങ്ങൾ നോക്കുമ്പോൾ അക്ഷരങ്ങൾ ഡാൻസ് കളിക്കുന്ന പോലെ തോന്നി.",

        "എൻ്റെ കൈയ്യക്ഷരം വളരെ മോശമായതുകൊണ്ട് ഞാൻ എഴുതിയത് എനിക്ക് തന്നെ വായിക്കാൻ പറ്റിയില്ല.",

        "പേപ്പറിൽ ഒരു ഉറുമ്പ് നടക്കുന്നത് കണ്ടു, അതിനെ ശല്യപ്പെടുത്തേണ്ട എന്ന് കരുതി ഞാൻ ഹോംവർക്ക് ചെയ്തില്ല.",

        "ഞാൻ ഭാവിയിലേക്ക് പോയി നാളത്തെ ഹോംവർക്ക് ചെയ്യാമെന്ന് കരുതി, പക്ഷേ ടൈം മെഷീൻ കേടായിപ്പോയി.",

        "എൻ്റെ പൂച്ച ലാപ്ടോപ്പിന്റെ കീബോർഡിൽ കയറി കിടന്നുറങ്ങി, രാവിലെ നോക്കിയപ്പോൾ ഫയൽ ഡിലീറ്റ് ആയിപ്പോയി.",

        "ഹോംവർക്ക് ചെയ്യുന്നതിനേക്കാൾ പ്രധാനപ്പെട്ട ഒരു കാര്യമുണ്ടായിരുന്നു - ഇന്നലത്തെ ക്രിക്കറ്റ് മാച്ചിന്റെ ഹൈലൈറ്റ്സ് കാണണമായിരുന്നു.",

        "ക്ഷമിക്കണം ടീച്ചറേ, സത്യം പറയാൻ എനിക്ക് നല്ലൊരു നുണയൊന്നും കിട്ടിയില്ല."
    ],
}


// --- Start of New Code for Voice Handling ---

let voices = [];

// This function gets the voices and is set as the event handler
function populateVoiceList() {
  voices = speechSynthesis.getVoices();
  console.log("Voices loaded:", voices); // For debugging
}

// Fetch voices initially
populateVoiceList();
// If the browser fires the 'voiceschanged' event, call the function again
if (speechSynthesis.onvoiceschanged !== undefined) {
  speechSynthesis.onvoiceschanged = populateVoiceList;
}

// --- End of New Code for Voice Handling ---


// excuses object is already defined above, so this duplicate declaration is removed.
const clickSound = new Audio('click.mp3'); // Make sure this path is correct

// The speak function is now more robust
function speak(text, lang) {
  if (speechSynthesis.speaking) {
    // Don't interrupt if already speaking
    return;
  }
  
  const utterance = new SpeechSynthesisUtterance(text);
  const languageCode = lang === 'ml' ? 'ml-IN' : 'en-US';
  
  // Find a matching voice from our pre-loaded list
  const selectedVoice = voices.find(voice => voice.lang === languageCode);
  
  if (selectedVoice) {
    utterance.voice = selectedVoice;
  } else {
    console.warn(`Voice for ${languageCode} not found. Using browser default.`);
    // The 'lang' property is a good fallback
    utterance.lang = languageCode;
  }
  
  speechSynthesis.cancel(); // Clear the queue
  speechSynthesis.speak(utterance);
}

function generateExcuse() {
  // Play click sound
  clickSound.currentTime = 0; 
  clickSound.play();

  // Get selected language
  const languageElement = document.getElementById("language");
  const lang = languageElement ? languageElement.value : "ml";
  
  // Get a random excuse
  const selectedExcuses = excuses[lang] || excuses["ml"];
  const randomIndex = Math.floor(Math.random() * selectedExcuses.length);
  const excuseText = selectedExcuses[randomIndex];
  
  // Update the text on the page
  const emojis = ["😂", "😅", "🙈", "🤦‍♂️"];
  document.getElementById("excuse").innerText = excuseText + " " + emojis[Math.floor(Math.random() * emojis.length)];
  
  // Speak the excuse text
  speak(excuseText, lang);
}