const excuses = {
    ml:[
        "à´àµ»àµà´±àµ† à´†à´Ÿàµ à´¹àµ‹à´‚à´µàµ¼à´•àµà´•àµ à´ªàµà´²àµà´²à´¾à´£àµ†à´¨àµà´¨àµ à´•à´°àµà´¤à´¿ à´¤à´¿à´¨àµà´¨àµ à´•à´³à´àµà´àµ à´Ÿàµ€à´šàµà´šà´±àµ‡.",
       
        "à´‡à´¨àµà´¨à´²àµ† à´°à´¾à´¤àµà´°à´¿à´¯à´¿à´²àµ† à´•à´¨à´¤àµà´¤ à´®à´´à´¯à´¿àµ½ à´àµ»àµà´±àµ† à´ªàµà´¸àµà´¤à´•à´‚ à´’à´²à´¿à´šàµà´šàµ à´ªàµà´´à´¯à´¿àµ½ à´ªàµ‹à´¯à´¿, à´‡à´ªàµà´ªàµ‹àµ¾ à´®àµ€à´¨àµà´•àµ¾ à´ªà´ à´¿à´•àµà´•àµà´¨àµà´¨àµà´£àµà´Ÿà´¾à´•àµà´‚.",

        "à´’à´°àµ à´…à´¨àµà´¯à´—àµà´°à´¹à´œàµ€à´µà´¿ à´àµ»àµà´±àµ† à´¹àµ‹à´‚à´µàµ¼à´•àµà´•àµ à´ªàµ‡à´ªàµà´ªàµ¼ à´’à´°àµ à´¬à´¹à´¿à´°à´¾à´•à´¾à´¶ à´®à´¾à´ªàµà´ªà´¾à´¯à´¿ à´¤àµ†à´±àµà´±à´¿à´¦àµà´§à´°à´¿à´šàµà´šàµ à´•àµŠà´£àµà´Ÿàµà´ªàµ‹à´¯à´¿.",
        
        "à´¹àµ‹à´‚à´µàµ¼à´•àµà´•àµ à´šàµ†à´¯àµà´¤ à´ªàµ‡à´ªàµà´ªàµ¼ à´•àµŠà´£àµà´Ÿàµ à´…à´¨à´¿à´¯àµ» à´µà´¿à´®à´¾à´¨à´‚ à´‰à´£àµà´Ÿà´¾à´•àµà´•à´¿ à´ªà´±à´¤àµà´¤à´¿à´•àµà´•à´³à´àµà´àµ.",

        "à´¹àµ¼à´¤àµà´¤à´¾àµ½ à´†à´¯à´¤àµà´•àµŠà´£àµà´Ÿàµ à´àµ»àµà´±àµ† à´ªàµ‡à´¨à´¯àµà´‚ à´ªà´£à´¿à´®àµà´Ÿà´•àµà´•à´¿àµ½ à´†à´¯à´¿à´°àµà´¨àµà´¨àµ.",

        "à´à´¾àµ» AI à´µàµ†à´šàµà´šàµ à´¹àµ‹à´‚à´µàµ¼à´•àµà´•àµ à´šàµ†à´¯àµà´¯à´¾àµ» à´¨àµ‹à´•àµà´•à´¿, à´ªà´•àµà´·àµ‡ à´…à´¤àµ à´®à´²à´¯à´¾à´³à´‚ à´¸à´¿à´¨à´¿à´®à´¯àµà´Ÿàµ† à´•à´¥ à´à´´àµà´¤à´¿ à´µàµ†à´šàµà´šàµ.",

        "à´•à´±à´£àµà´Ÿàµ à´ªàµ‹à´¯à´ªàµà´ªàµ‹àµ¾ à´®àµ†à´´àµà´•àµà´¤à´¿à´°à´¿ à´µàµ†à´šàµà´šàµ à´ªà´ à´¿à´•àµà´•à´¾àµ» à´‡à´°àµà´¨àµà´¨à´¤à´¾, à´®àµ†à´´àµà´•àµ à´®àµà´´àµà´µàµ» à´ªàµà´¸àµà´¤à´•à´¤àµà´¤à´¿àµ½ à´µàµ€à´£àµ à´…à´•àµà´·à´°à´™àµà´™àµ¾ à´’à´Ÿàµà´Ÿà´¿à´šàµà´šàµ‡àµ¼à´¨àµà´¨àµ.",

        "à´…à´®àµà´®àµ‚à´®àµà´® à´àµ»àµà´±àµ† à´¹àµ‹à´‚à´µàµ¼à´•àµà´•àµ à´ªàµ‡à´ªàµà´ªà´±à´¿àµ»àµà´±àµ† à´ªàµà´±à´•à´¿àµ½ à´¸à´¾à´®àµà´ªà´¾àµ¼ à´‰à´£àµà´Ÿà´¾à´•àµà´•àµà´¨àµà´¨ à´µà´¿à´§à´‚ à´à´´àµà´¤à´¿à´µàµ†à´šàµà´šàµ.",

        "à´àµ»àµà´±àµ† à´…à´šàµà´›àµ» à´† à´ªàµ‡à´ªàµà´ªà´±à´¿àµ½ à´²àµ‹à´Ÿàµà´Ÿà´±à´¿ à´Ÿà´¿à´•àµà´•à´±àµà´±à´¿à´¨àµà´±àµ† à´¨à´®àµà´ªàµ¼ à´•àµà´±à´¿à´šàµà´šàµà´µàµ†à´šàµà´šàµ, à´‡à´¨à´¿ à´…à´Ÿà´¿à´•àµà´•àµà´®àµ‹ à´à´¨àµà´¨à´±à´¿à´¯à´¾àµ» à´•à´¾à´¤àµà´¤à´¿à´°à´¿à´•àµà´•àµà´•à´¯à´¾à´£àµ.",

        "à´à´¾àµ» à´¹àµ‹à´‚à´µàµ¼à´•àµà´•àµ à´‰à´±à´•àµà´•àµ† à´ªà´ à´¿à´•àµà´•àµà´¨àµà´¨à´¤àµ à´•àµ‡à´Ÿàµà´Ÿàµ à´àµ»àµà´±àµ† à´¤à´¤àµà´¤ à´…à´¤àµ†à´²àµà´²à´¾à´‚ à´•à´¾à´£à´¾à´¤àµ† à´ªà´ à´¿à´šàµà´šàµ, à´à´¨àµà´¨à´¿à´Ÿàµà´Ÿàµ à´ªà´±à´¨àµà´¨àµà´ªàµ‹à´¯à´¿.",

        "à´’à´°àµ à´•à´¾à´•àµà´• à´µà´¨àµà´¨àµ à´àµ»àµà´±àµ† à´ªàµ‡à´¨ à´•àµŠà´¤àµà´¤à´¿à´•àµà´•àµŠà´£àµà´Ÿàµ à´ªàµ‹à´¯à´¿, à´…à´¤à´¿à´¨àµ à´¤à´¿à´³à´•àµà´•à´®àµà´£àµà´Ÿà´¾à´¯à´¿à´°àµà´¨àµà´¨àµ à´ªàµ‹à´²àµà´‚.",

        "à´¹àµ‹à´‚à´µàµ¼à´•àµà´•à´¿à´¨àµà´±àµ† à´¯à´¥à´¾àµ¼à´¤àµà´¥ à´…àµ¼à´¤àµà´¥à´‚ à´à´¨àµà´¤à´¾à´£àµ†à´¨àµà´¨àµ à´†à´²àµ‹à´šà´¿à´šàµà´šàµ à´à´¾àµ» à´§àµà´¯à´¾à´¨à´¤àµà´¤à´¿àµ½ à´‡à´°àµà´¨àµà´¨àµ à´ªàµ‹à´¯à´¿.",

        "à´µàµ€à´Ÿàµ à´µàµƒà´¤àµà´¤à´¿à´¯à´¾à´•àµà´•àµà´¨àµà´¨à´¤à´¿à´¨à´¿à´Ÿà´¯à´¿àµ½ à´…à´®àµà´® à´…à´¤àµŠà´°àµ à´ªà´´à´¯ à´ªàµ‡à´ªàµà´ªà´±à´¾à´£àµ†à´¨àµà´¨àµ à´•à´°àµà´¤à´¿ à´¤àµ‚à´•àµà´•à´¿ à´µà´¿à´±àµà´±àµ.",

        "à´µà´²àµà´²à´¾à´¤àµà´¤àµŠà´°àµ à´¤à´²à´µàµ‡à´¦à´¨à´¯à´¾à´¯à´¿à´°àµà´¨àµà´¨àµ à´Ÿàµ€à´šàµà´šà´±àµ‡, à´šàµ‹à´¦àµà´¯à´™àµà´™àµ¾ à´¨àµ‹à´•àµà´•àµà´®àµà´ªàµ‹àµ¾ à´…à´•àµà´·à´°à´™àµà´™àµ¾ à´¡à´¾àµ»à´¸àµ à´•à´³à´¿à´•àµà´•àµà´¨àµà´¨ à´ªàµ‹à´²àµ† à´¤àµ‹à´¨àµà´¨à´¿.",

        "à´àµ»àµà´±àµ† à´•àµˆà´¯àµà´¯à´•àµà´·à´°à´‚ à´µà´³à´°àµ† à´®àµ‹à´¶à´®à´¾à´¯à´¤àµà´•àµŠà´£àµà´Ÿàµ à´à´¾àµ» à´à´´àµà´¤à´¿à´¯à´¤àµ à´à´¨à´¿à´•àµà´•àµ à´¤à´¨àµà´¨àµ† à´µà´¾à´¯à´¿à´•àµà´•à´¾àµ» à´ªà´±àµà´±à´¿à´¯à´¿à´²àµà´².",

        "à´ªàµ‡à´ªàµà´ªà´±à´¿àµ½ à´’à´°àµ à´‰à´±àµà´®àµà´ªàµ à´¨à´Ÿà´•àµà´•àµà´¨àµà´¨à´¤àµ à´•à´£àµà´Ÿàµ, à´…à´¤à´¿à´¨àµ† à´¶à´²àµà´¯à´ªàµà´ªàµ†à´Ÿàµà´¤àµà´¤àµ‡à´£àµà´Ÿ à´à´¨àµà´¨àµ à´•à´°àµà´¤à´¿ à´à´¾àµ» à´¹àµ‹à´‚à´µàµ¼à´•àµà´•àµ à´šàµ†à´¯àµà´¤à´¿à´²àµà´².",

        "à´à´¾àµ» à´­à´¾à´µà´¿à´¯à´¿à´²àµ‡à´•àµà´•àµ à´ªàµ‹à´¯à´¿ à´¨à´¾à´³à´¤àµà´¤àµ† à´¹àµ‹à´‚à´µàµ¼à´•àµà´•àµ à´šàµ†à´¯àµà´¯à´¾à´®àµ†à´¨àµà´¨àµ à´•à´°àµà´¤à´¿, à´ªà´•àµà´·àµ‡ à´Ÿàµˆà´‚ à´®àµ†à´·àµ€àµ» à´•àµ‡à´Ÿà´¾à´¯à´¿à´ªàµà´ªàµ‹à´¯à´¿.",

        "à´àµ»àµà´±àµ† à´ªàµ‚à´šàµà´š à´²à´¾à´ªàµà´Ÿàµ‹à´ªàµà´ªà´¿à´¨àµà´±àµ† à´•àµ€à´¬àµ‹àµ¼à´¡à´¿àµ½ à´•à´¯à´±à´¿ à´•à´¿à´Ÿà´¨àµà´¨àµà´±à´™àµà´™à´¿, à´°à´¾à´µà´¿à´²àµ† à´¨àµ‹à´•àµà´•à´¿à´¯à´ªàµà´ªàµ‹àµ¾ à´«à´¯àµ½ à´¡à´¿à´²àµ€à´±àµà´±àµ à´†à´¯à´¿à´ªàµà´ªàµ‹à´¯à´¿.",

        "à´¹àµ‹à´‚à´µàµ¼à´•àµà´•àµ à´šàµ†à´¯àµà´¯àµà´¨àµà´¨à´¤à´¿à´¨àµ‡à´•àµà´•à´¾àµ¾ à´ªàµà´°à´§à´¾à´¨à´ªàµà´ªàµ†à´Ÿàµà´Ÿ à´’à´°àµ à´•à´¾à´°àµà´¯à´®àµà´£àµà´Ÿà´¾à´¯à´¿à´°àµà´¨àµà´¨àµ - à´‡à´¨àµà´¨à´²à´¤àµà´¤àµ† à´•àµà´°à´¿à´•àµà´•à´±àµà´±àµ à´®à´¾à´šàµà´šà´¿à´¨àµà´±àµ† à´¹àµˆà´²àµˆà´±àµà´±àµà´¸àµ à´•à´¾à´£à´£à´®à´¾à´¯à´¿à´°àµà´¨àµà´¨àµ.",

        "à´•àµà´·à´®à´¿à´•àµà´•à´£à´‚ à´Ÿàµ€à´šàµà´šà´±àµ‡, à´¸à´¤àµà´¯à´‚ à´ªà´±à´¯à´¾àµ» à´à´¨à´¿à´•àµà´•àµ à´¨à´²àµà´²àµŠà´°àµ à´¨àµà´£à´¯àµŠà´¨àµà´¨àµà´‚ à´•à´¿à´Ÿàµà´Ÿà´¿à´¯à´¿à´²àµà´²."
    ],
}


// --- Start of New Code for Voice Handling ---

let voices = [];

// This function gets the voices and is set as the event handler
function populateVoiceList() {
  voices = speechSynthesis.getVoices();
  console.log("Voices loaded:", voices); // For debugging
}

// Fetch voices initially
populateVoiceList();
// If the browser fires the 'voiceschanged' event, call the function again
if (speechSynthesis.onvoiceschanged !== undefined) {
  speechSynthesis.onvoiceschanged = populateVoiceList;
}

// --- End of New Code for Voice Handling ---


// excuses object is already defined above, so this duplicate declaration is removed.
const clickSound = new Audio('click.mp3'); // Make sure this path is correct

// The speak function is now more robust
function speak(text, lang) {
  if (speechSynthesis.speaking) {
    // Don't interrupt if already speaking
    return;
  }
  
  const utterance = new SpeechSynthesisUtterance(text);
  const languageCode = lang === 'ml' ? 'ml-IN' : 'en-US';
  
  // Find a matching voice from our pre-loaded list
  const selectedVoice = voices.find(voice => voice.lang === languageCode);
  
  if (selectedVoice) {
    utterance.voice = selectedVoice;
  } else {
    console.warn(`Voice for ${languageCode} not found. Using browser default.`);
    // The 'lang' property is a good fallback
    utterance.lang = languageCode;
  }
  
  speechSynthesis.cancel(); // Clear the queue
  speechSynthesis.speak(utterance);
}

function generateExcuse() {
  // Play click sound
  clickSound.currentTime = 0; 
  clickSound.play();

  // Get selected language
  const languageElement = document.getElementById("language");
  const lang = languageElement ? languageElement.value : "ml";
  
  // Get a random excuse
  const selectedExcuses = excuses[lang] || excuses["ml"];
  const randomIndex = Math.floor(Math.random() * selectedExcuses.length);
  const excuseText = selectedExcuses[randomIndex];
  
  // Update the text on the page
  const emojis = ["ğŸ˜‚", "ğŸ˜…", "ğŸ™ˆ", "ğŸ¤¦â€â™‚ï¸"];
  document.getElementById("excuse").innerText = excuseText + " " + emojis[Math.floor(Math.random() * emojis.length)];
  
  // Speak the excuse text
  speak(excuseText, lang);
}